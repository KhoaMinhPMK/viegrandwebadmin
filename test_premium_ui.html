<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Premium UI Updates</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            background: #f8f9fa;
            border-left: 4px solid #007bff;
        }
        .error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        .success {
            border-left-color: #28a745;
            background: #d4edda;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Test Premium UI Updates</h1>
        <p>This page tests the updated premium details functionality that now fetches data from the premium_subscriptions_json table.</p>
        
        <div class="test-section">
            <h3>1. Test Premium Details API</h3>
            <p>Test the new get_premium_details.php API endpoint</p>
            <input type="text" id="testUserId" placeholder="Enter User ID" style="width: 200px; padding: 8px; margin-right: 10px;">
            <button class="test-button" onclick="testPremiumDetailsAPI()">Test API</button>
            <div id="apiResult" class="result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h3>2. Test Update Premium Date API</h3>
            <p>Test the new update_premium_date_v2.php API endpoint</p>
            <input type="text" id="updateUserId" placeholder="Enter User ID" style="width: 200px; padding: 8px; margin-right: 10px;">
            <input type="date" id="newEndDate" style="padding: 8px; margin-right: 10px;">
            <button class="test-button" onclick="testUpdateDateAPI()">Test Update</button>
            <div id="updateResult" class="result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h3>3. Test Elderly Management APIs</h3>
            <p>Test the elderly management functionality</p>
            <div style="margin-bottom: 10px;">
                <input type="text" id="elderlyRelativeId" placeholder="Relative User ID" style="width: 150px; padding: 8px; margin-right: 10px;">
                <input type="text" id="elderlyPrivateKey" placeholder="Elderly Private Key" style="width: 200px; padding: 8px; margin-right: 10px;">
                <button class="test-button" onclick="testAddElderly()">Add Elderly</button>
            </div>
            <div style="margin-bottom: 10px;">
                <input type="text" id="removeRelativeId" placeholder="Relative User ID" style="width: 150px; padding: 8px; margin-right: 10px;">
                <input type="text" id="removeElderlyKey" placeholder="Elderly Private Key" style="width: 200px; padding: 8px; margin-right: 10px;">
                <button class="test-button" onclick="testRemoveElderly()">Remove Elderly</button>
            </div>
            <div style="margin-bottom: 10px;">
                <input type="text" id="listUserId" placeholder="User ID" style="width: 200px; padding: 8px; margin-right: 10px;">
                <button class="test-button" onclick="testListElderly()">List Elderly</button>
            </div>
            <div id="elderlyResult" class="result" style="display: none;"></div>
        </div>
    </div>

    <script>
        async function testPremiumDetailsAPI() {
            const userId = document.getElementById('testUserId').value.trim();
            const resultDiv = document.getElementById('apiResult');
            
            if (!userId) {
                showResult(resultDiv, 'Please enter a User ID', 'error');
                return;
            }
            
            try {
                const response = await fetch(`https://viegrand.site/viegrandwebadmin/php/get_premium_details.php?user_id=${userId}`);
                const result = await response.json();
                
                if (result.success) {
                    showResult(resultDiv, `Success! Premium Details:
- Premium Key: ${result.data.premium_key}
- Start Date: ${result.data.start_date}
- End Date: ${result.data.end_date}
- Status: ${result.data.status}
- Time Remaining: ${result.data.time_remaining}
- Elderly Count: ${result.data.elderly_count}`, 'success');
                } else {
                    showResult(resultDiv, `Error: ${result.message}`, 'error');
                }
            } catch (error) {
                showResult(resultDiv, `Network Error: ${error.message}`, 'error');
            }
        }
        
        async function testUpdateDateAPI() {
            const userId = document.getElementById('updateUserId').value.trim();
            const newEndDate = document.getElementById('newEndDate').value;
            const resultDiv = document.getElementById('updateResult');
            
            if (!userId || !newEndDate) {
                showResult(resultDiv, 'Please enter both User ID and new end date', 'error');
                return;
            }
            
            try {
                const formData = new FormData();
                formData.append('userId', userId);
                formData.append('newEndDate', newEndDate);
                
                const response = await fetch('https://viegrand.site/viegrandwebadmin/php/update_premium_date_v2.php', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showResult(resultDiv, `Success! Updated premium end date to: ${result.data.premium_end_date}`, 'success');
                } else {
                    showResult(resultDiv, `Error: ${result.message}`, 'error');
                }
            } catch (error) {
                showResult(resultDiv, `Network Error: ${error.message}`, 'error');
            }
        }
        
        async function testAddElderly() {
            const relativeId = document.getElementById('elderlyRelativeId').value.trim();
            const elderlyKey = document.getElementById('elderlyPrivateKey').value.trim();
            const resultDiv = document.getElementById('elderlyResult');
            
            if (!relativeId || !elderlyKey) {
                showResult(resultDiv, 'Please enter both Relative User ID and Elderly Private Key', 'error');
                return;
            }
            
            try {
                const response = await fetch('https://viegrand.site/viegrandwebadmin/php/add_elderly_to_premium.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        relative_user_id: relativeId,
                        elderly_private_key: elderlyKey
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showResult(resultDiv, `Success! Added elderly user to premium subscription`, 'success');
                } else {
                    showResult(resultDiv, `Error: ${result.message}`, 'error');
                }
            } catch (error) {
                showResult(resultDiv, `Network Error: ${error.message}`, 'error');
            }
        }
        
        async function testRemoveElderly() {
            const relativeId = document.getElementById('removeRelativeId').value.trim();
            const elderlyKey = document.getElementById('removeElderlyKey').value.trim();
            const resultDiv = document.getElementById('elderlyResult');
            
            if (!relativeId || !elderlyKey) {
                showResult(resultDiv, 'Please enter both Relative User ID and Elderly Private Key', 'error');
                return;
            }
            
            try {
                const response = await fetch('https://viegrand.site/viegrandwebadmin/php/remove_elderly_from_premium.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        relative_user_id: relativeId,
                        elderly_private_key: elderlyKey
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showResult(resultDiv, `Success! Removed elderly user from premium subscription`, 'success');
                } else {
                    showResult(resultDiv, `Error: ${result.message}`, 'error');
                }
            } catch (error) {
                showResult(resultDiv, `Network Error: ${error.message}`, 'error');
            }
        }
        
        async function testListElderly() {
            const userId = document.getElementById('listUserId').value.trim();
            const resultDiv = document.getElementById('elderlyResult');
            
            if (!userId) {
                showResult(resultDiv, 'Please enter a User ID', 'error');
                return;
            }
            
            try {
                const response = await fetch(`https://viegrand.site/viegrandwebadmin/php/get_elderly_in_premium.php?user_id=${userId}`);
                const result = await response.json();
                
                if (result.success) {
                    let message = `Success! Found ${result.data.length} elderly users:`;
                    result.data.forEach((elderly, index) => {
                        message += `
${index + 1}. Private Key: ${elderly.private_key}
   Name: ${elderly.full_name || 'No name'}
   Phone: ${elderly.phone || 'No phone'}`;
                    });
                    showResult(resultDiv, message, 'success');
                } else {
                    showResult(resultDiv, `Error: ${result.message}`, 'error');
                }
            } catch (error) {
                showResult(resultDiv, `Network Error: ${error.message}`, 'error');
            }
        }
        
        function showResult(resultDiv, message, type) {
            resultDiv.style.display = 'block';
            resultDiv.className = `result ${type}`;
            resultDiv.innerHTML = `<pre>${message}</pre>`;
        }
    </script>
</body>
</html>
